<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±é›„è”ç›Ÿè¯­éŸ³åº“</title>
	<link rel="icon" href="favicon.ico" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- æ·»åŠ Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        :root {
            --primary-color: #c8aa6e;
            --dark-bg: #0e1429;
            --panel-bg: rgba(10, 16, 36, 0.9);
            --panel-border: #463714;
            --text-color: #e8d7a0;
            --hover-color: #463714;
        }
        
        body {
            background-color: var(--dark-bg);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            height: 100vh;
            overflow: hidden;
            position: relative;
            margin: 0;
        }
        
        .hero-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            transition: background-image 0.8s ease;
        }
        
        /* æŠ˜å æŒ‰é’® */
        .fold-btn {
            position: absolute;
            z-index: 500;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            color: var(--primary-color);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .fold-btn:hover {
            background: var(--primary-color);
            color: var(--dark-bg);
        }
        
        #left-fold-btn {
            top: 10px;
            left: 10px;
            transform: rotate(180deg);
        }
        
        #top-fold-btn {
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        #right-fold-btn {
            top: 10px;
            right: 10px;
        }
        
        /* ä¸»å®¹å™¨ */
        .main-container {
            display: flex;
            height: 100vh;
            padding: 10px;
            gap: 10px;
            transition: all 0.4s ease;
        }
        
        /* é¢æ¿æ ·å¼ */
        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(200, 170, 110, 0.2);
            backdrop-filter: blur(5px);
            padding: 15px;
            transition: all 0.4s ease;
            overflow: hidden;
            height: calc(100% - 20px);
        }
        
        /* å„é¢æ¿å®½åº¦ */
        .hero-list {
            width: 250px;
        }
        
        .skin-list {
            width: 100%;
            height: 180px; /* å¢åŠ é«˜åº¦ */
        }
        
        .voice-list {
            width: 300px;
        }
        
        /* é¢æ¿å¤´éƒ¨ */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--panel-border);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .panel-header h3 {
            color: var(--primary-color);
            font-size: 1.2rem;
            margin: 0;
        }
        
        .toggle-btn {
            background: transparent;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 4px;
            padding: 2px 8px;
            cursor: pointer;
            min-width: 30px;
        }
        
        /* åˆ—è¡¨å®¹å™¨ */
        .list-container {
            overflow-y: auto;
            height: calc(100% - 40px);
            scrollbar-width: thin;
            scrollbar-color: var(--primary-color) var(--dark-bg);
        }
        
        .list-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .list-container::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }
        
        .list-container::-webkit-scrollbar-thumb {
            background-color: var(--primary-color);
            border-radius: 4px;
        }
        
        /* åˆ—è¡¨é¡¹ */
        .list-item {
            padding: 12px;
            cursor: pointer;
            border: 1px solid transparent;
            margin-bottom: 8px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            background: rgba(22, 31, 59, 0.6);
        }
        
        .list-item:hover {
            background: rgba(39, 52, 92, 0.7);
            transform: translateX(2px);
        }
        
        .list-item.active {
            border-color: var(--primary-color);
            background: rgba(39, 52, 92, 0.9);
            box-shadow: 0 0 8px rgba(200, 170, 110, 0.4);
        }
        
        /* è‹±é›„é¡¹ */
        .hero-item {
            height: 60px;
        }
        
        .hero-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
            border: 2px solid var(--panel-border);
        }
        
        .hero-title {
            font-size: 1rem;
            font-weight: bold;
        }
        
        .hero-name {
            font-size: 0.85rem;
            color: #9b8d6c;
        }
        
        /* çš®è‚¤é¡¹ */
        .skin-img {
            width: 100px;
            height: 60px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 10px;
            border: 1px solid var(--panel-border);
        }
        
        .skin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        /* è¯­éŸ³é¡¹ */
        .voice-item {
            padding: 10px;
            display: flex;
            align-items: center;
        }
        
        .voice-icon {
            color: var(--primary-color);
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .voice-text {
            font-size: 0.9rem;
            flex-grow: 1;
        }
        
        /* å­—å¹•åŒºåŸŸ */
        .subtitle-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(10, 16, 36, 0.9);
            padding: 15px 20px;
            text-align: center;
            border-top: 2px solid var(--primary-color);
            font-size: 1.5rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            color: var(--text-color);
            z-index: 100;
        }
        
        .subtitle-container.show {
            transform: translateY(0);
        }
        
        /* æ§åˆ¶æŒ‰é’® */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            gap: 10px;
        }
        
        .control-btn {
            background: var(--panel-border);
            color: var(--text-color);
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        .control-btn:hover {
            background: var(--primary-color);
            color: var(--dark-bg);
        }
        
        /* ç©ºçŠ¶æ€ */
        .no-data {
            text-align: center;
            padding: 30px;
            color: #9b8d6c;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: var(--primary-color);
        }
        
        /* éŸ³é¢‘æ’­æ”¾å™¨ */
        .player {
            display: none;
        }
        
        /* æŠ˜å çŠ¶æ€ */
        .main-container.hide-left .hero-list {
            display: none;
        }
        
        .main-container.hide-top .skin-list {
            display: none;
        }
        
        .main-container.hide-right .voice-list {
            display: none;
        }
        
        .content-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        /* çš®è‚¤åˆ—è¡¨é«˜åº¦è°ƒæ•´ */
        .skin-list .list-container {
            height: calc(100% - 40px);
        }
        /* å³ä¸‹è§’æŒ‰é’®å®¹å™¨æ ·å¼ */
        .footer-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 400;
        }
        
        .footer-btn {
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            color: var(--text-color);
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .footer-btn:hover {
            background: var(--primary-color);
            color: var(--dark-bg);
        }
        
        /* æ¨¡æ€æ¡†æ ·å¼è°ƒæ•´ */
        .modal-content {
            background-color: var(--panel-bg);
            color: var(--text-color);
            border: 1px solid var(--panel-border);
        }
        
        .modal-header, .modal-footer {
            border-color: var(--panel-border);
        }
        
        .btn-close {
            filter: invert(0.7);
        }
        
        /* æ§åˆ¶æŒ‰é’®å®¹å™¨ */
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- è‹±é›„æµ·æŠ¥èƒŒæ™¯ -->
    <div class="hero-bg" id="heroBackground"></div>
    
    <!-- æŠ˜å æ§åˆ¶æŒ‰é’® -->
    <button id="left-fold-btn" class="fold-btn">â—€</button>
    <button id="top-fold-btn" class="fold-btn">â–¼</button>
    <button id="right-fold-btn" class="fold-btn">â—€</button>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="main-container">
        <!-- å·¦ä¾§è‹±é›„åˆ—è¡¨ -->
        <div class="panel hero-list">
            <div class="panel-header">
                <h3>è‹±é›„åˆ—è¡¨</h3>
                <button class="toggle-btn" onclick="togglePanel('left')">-</button>
            </div>
            <div class="list-container" id="heroList">
                <div class="loading">åŠ è½½è‹±é›„æ•°æ®ä¸­...</div>
            </div>
        </div>
        
        <!-- ä¸­é—´åŒºåŸŸ -->
        <div class="content-area">
            <!-- é¡¶éƒ¨çš®è‚¤åˆ—è¡¨ -->
            <div class="panel skin-list">
                <div class="panel-header">
                    <h3>çš®è‚¤åˆ—è¡¨</h3>
                    <button class="toggle-btn" onclick="togglePanel('top')">-</button>
                </div>
                <div class="list-container" id="skinList">
                    <div class="no-data">è¯·å…ˆé€‰æ‹©è‹±é›„</div>
                </div>
            </div>
            
            <!-- å†…å®¹åŒº - å·²ç§»é™¤å¤šä½™å†…å®¹ -->
            <div style="flex: 1;"></div>
        </div>
        
        <!-- å³ä¾§è¯­éŸ³åˆ—è¡¨ -->
        <div class="panel voice-list">
            <div class="panel-header">
                <h3>è¯­éŸ³åˆ—è¡¨</h3>
                <button class="toggle-btn" onclick="togglePanel('right')">-</button>
            </div>
            <div class="list-container" id="voiceList">
                <div class="no-data">è¯·å…ˆé€‰æ‹©çš®è‚¤</div>
            </div>
            <div class="controls">
                <button class="control-btn" id="playAllBtn">
                    <span class="icon">â–¶</span> é¡ºåºæ’­æ”¾
                </button>
                <!-- æ–°å¢å¾ªç¯æ’­æ”¾æŒ‰é’® -->
                <button class="control-btn" id="loopPlayBtn">
                    <span class="icon">ğŸ”</span> å¾ªç¯æ’­æ”¾
                </button>
            </div>
        </div>
    </div>
    
    <!-- å­—å¹•å®¹å™¨ -->
    <div class="subtitle-container" id="subtitle"></div>
    
    <!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
    <audio class="player" id="audioPlayer"></audio>
    
    <!-- å³ä¸‹è§’æŒ‰é’® -->
    <div class="footer-buttons">
        <button class="footer-btn" id="githubBtn">
            <span>GitHub</span>
        </button>
        <button class="footer-btn" id="aboutBtn">
            <span>å…³äº</span>
        </button>
    </div>
    
    <!-- å…³äºæ¨¡æ€æ¡† -->
    <div class="modal fade" id="aboutModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">å…³äº</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <div style="font-size: 4rem; color: #c8aa6e;">
                            <i class="bi bi-mic"></i>
                        </div>
                        <h4>è‹±é›„è”ç›Ÿè¯­éŸ³åº“</h4>
                    </div>
                    <p>è¿™æ˜¯ä¸€ä¸ªè‹±é›„è”ç›Ÿè¯­éŸ³åº“ç½‘é¡µï¼Œç”¨äºæ¢ç´¢å’Œæ¬£èµæ¸¸æˆä¸­è‹±é›„çš„è¯­éŸ³ã€‚</p>
                    <p><strong>ä¸»è¦åŠŸèƒ½ï¼š</strong></p>
                    <ul>
                        <li>æµè§ˆæ‰€æœ‰è‹±é›„å’Œä»–ä»¬çš„çš®è‚¤</li>
                        <li>æŸ¥çœ‹æ¯ä¸ªçš®è‚¤å¯¹åº”çš„è¯­éŸ³å°è¯</li>
                        <li>æ’­æ”¾é€‰ä¸­çš„è¯­éŸ³å¹¶æ˜¾ç¤ºå­—å¹•</li>
                        <li>é¡ºåºæ’­æ”¾æˆ–å¾ªç¯æ’­æ”¾è¯­éŸ³åˆ—è¡¨</li>
                    </ul>
                    <hr style="border-color: #463714">
                    <p>ç«™é•¿ï¼šå“€æ­Œæ®‡å¹´</p>
                    <p>QQï¼š2690034441</p>
                    <p class="mt-3"><i class="bi bi-exclamation-circle me-1"></i> æœ¬å·¥å…·ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œæ¬£èµï¼Œæ‰€æœ‰ç´ æç‰ˆæƒå½’æ‹³å¤´æ¸¸æˆ(Riot Games)æ‰€æœ‰ã€‚</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å…³é—­</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // å…¨å±€å˜é‡
        let championData = null;
        let skinData = null;
        let soundData = null;
        let currentChampion = null;
        let currentSkin = null;
        let currentSound = null;
        let isPlayingAll = false;
        let isLooping = false;
        let playQueue = [];
        let currentPlayingIndex = -1;
        let loopInterval = null;
        
        // DOMåŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // åˆå§‹åŒ–ç•Œé¢
            loadData();
            
            // æ³¨å†Œäº‹ä»¶ç›‘å¬
            document.getElementById('playAllBtn').addEventListener('click', togglePlayAll);
            document.getElementById('loopPlayBtn').addEventListener('click', toggleLoopPlay);
            document.getElementById('audioPlayer').addEventListener('ended', playNextSound);
            
            // æŠ˜å æŒ‰é’®
            document.getElementById('left-fold-btn').addEventListener('click', () => togglePanel('left'));
            document.getElementById('top-fold-btn').addEventListener('click', () => togglePanel('top'));
            document.getElementById('right-fold-btn').addEventListener('click', () => togglePanel('right'));
            
            // å³ä¸‹è§’æŒ‰é’®
            document.getElementById('githubBtn').addEventListener('click', () => {
                window.open("https://github.com/liveldy/League-of-Legends-Sounds");
            });
            
            document.getElementById('aboutBtn').addEventListener('click', () => {
                // æ˜¾ç¤ºå…³äºæ¨¡æ€æ¡†
                const aboutModal = new bootstrap.Modal(document.getElementById('aboutModal'));
                aboutModal.show();
            });
        });
        
        // åŠ è½½JSONæ•°æ®
        async function loadData() {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('heroList').innerHTML = '<div class="loading">åŠ è½½è‹±é›„æ•°æ®ä¸­...</div>';
                
                // ä½¿ç”¨Promise.allåŒæ—¶åŠ è½½æ‰€æœ‰æ–‡ä»¶
                const [championRes, skinRes, soundRes] = await Promise.all([
                    fetch('data/champion.json'),
                    fetch('data/skin.json'),
                    fetch('data/sound.json')
                ]);
                
                // æ£€æŸ¥æ‰€æœ‰å“åº”æ˜¯å¦æˆåŠŸ
                if (!championRes.ok || !skinRes.ok || !soundRes.ok) {
                    throw new Error('éƒ¨åˆ†JSONæ–‡ä»¶åŠ è½½å¤±è´¥');
                }
                
                // è§£æJSON
                championData = await championRes.json();
                skinData = await skinRes.json();
                soundData = await soundRes.json();
                
                // æ•°æ®åŠ è½½å®Œæˆååˆå§‹åŒ–ç•Œé¢
                renderChampionList();
                if (championData.champions.length > 0) {
                    selectChampion(championData.champions[0].id);
                }
            } catch (error) {
                console.error('æ•°æ®åŠ è½½é”™è¯¯:', error);
                // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                document.getElementById('heroList').innerHTML = '<div class="no-data">è‹±é›„æ•°æ®åŠ è½½å¤±è´¥</div>';
                document.getElementById('skinList').innerHTML = '<div class="no-data">çš®è‚¤æ•°æ®åŠ è½½å¤±è´¥</div>';
                document.getElementById('voiceList').innerHTML = '<div class="no-data">è¯­éŸ³æ•°æ®åŠ è½½å¤±è´¥</div>';
            }
        }
        
        // æ¸²æŸ“è‹±é›„åˆ—è¡¨
        function renderChampionList() {
            const container = document.getElementById('heroList');
            container.innerHTML = '';
            
            if (!championData || !championData.champions || championData.champions.length === 0) {
                container.innerHTML = '<div class="no-data">æ²¡æœ‰å¯ç”¨çš„è‹±é›„æ•°æ®</div>';
                return;
            }
            
            championData.champions.forEach(champ => {
                const heroEl = document.createElement('div');
                heroEl.className = 'list-item hero-item';
                heroEl.dataset.id = champ.id;
                heroEl.innerHTML = `
                    <img class="hero-img" src="icon/${champ.id}.jpg" onerror="this.src='https://via.placeholder.com/50/0e1429/c8aa6e?text=Hero'">
                    <div>
                        <div class="hero-title">${champ.name}</div>
                        <div class="hero-name">${champ.title}</div>
                    </div>
                `;
                heroEl.addEventListener('click', () => selectChampion(champ.id));
                container.appendChild(heroEl);
            });
        }
        
        // æ¸²æŸ“çš®è‚¤åˆ—è¡¨
        function renderSkinList(champion) {
            const container = document.getElementById('skinList');
            container.innerHTML = '';
            
            if (!champion) {
                container.innerHTML = '<div class="no-data">è¯·å…ˆé€‰æ‹©è‹±é›„</div>';
                return;
            }
            
            if (!skinData) {
                container.innerHTML = '<div class="no-data">çš®è‚¤æ•°æ®æœªåŠ è½½</div>';
                return;
            }
            
            // åˆ›å»ºç½‘æ ¼å®¹å™¨
            const grid = document.createElement('div');
            grid.className = 'skin-grid';
            container.appendChild(grid);
            
            // è·å–è¯¥è‹±é›„çš„æ‰€æœ‰çš®è‚¤
            const skins = skinData.skins.filter(skin => champion.skinIds.includes(skin.id));
            
            if (skins.length === 0) {
                container.innerHTML = '<div class="no-data">è¯¥è‹±é›„æš‚æ— å¯ç”¨çš®è‚¤</div>';
                return;
            }
            
            skins.forEach(skin => {
                const skinEl = document.createElement('div');
                skinEl.className = `list-item skin-item ${currentSkin?.id === skin.id ? 'active' : ''}`;
                skinEl.dataset.id = skin.id;
                skinEl.innerHTML = `
                    <img class="skin-img" src="skin/${skin.id}.jpg" onerror="this.src='https://via.placeholder.com/100x60/0e1429/c8aa6e?text=SK'">
                    <span>${skin.name}</span>
                `;
                skinEl.addEventListener('click', () => selectSkin(skin.id));
                grid.appendChild(skinEl);
            });
        }
        
        // æ¸²æŸ“è¯­éŸ³åˆ—è¡¨
        function renderVoiceList(skin) {
            const container = document.getElementById('voiceList');
            container.innerHTML = '';
            
            if (!skin) {
                container.innerHTML = '<div class="no-data">è¯·å…ˆé€‰æ‹©çš®è‚¤</div>';
                return;
            }
            
            if (!soundData) {
                container.innerHTML = '<div class="no-data">è¯­éŸ³æ•°æ®æœªåŠ è½½</div>';
                return;
            }
            
            // è·å–è¯¥çš®è‚¤çš„æ‰€æœ‰è¯­éŸ³
            const voices = skin.soundIds.map(id => soundData.sounds.find(sound => sound.id === id)).filter(Boolean);
            
            if (voices.length === 0) {
                container.innerHTML = '<div class="no-data">è¯¥çš®è‚¤æš‚æ— å¯ç”¨è¯­éŸ³</div>';
                return;
            }
            
            voices.forEach(voice => {
                const voiceEl = document.createElement('div');
                voiceEl.className = `list-item voice-item ${currentSound?.id === voice.id ? 'active' : ''}`;
                voiceEl.dataset.id = voice.id;
                voiceEl.innerHTML = `
                    <div class="voice-icon">ğŸ”Š</div>
                    <div class="voice-text">${voice.text}</div>
                `;
                voiceEl.addEventListener('click', () => selectSound(voice.id));
                container.appendChild(voiceEl);
            });
        }
        
        // é€‰æ‹©è‹±é›„
        function selectChampion(champId) {
            const heroItems = document.querySelectorAll('#heroList .list-item');
            heroItems.forEach(item => item.classList.remove('active'));
            const selectedItem = document.querySelector(`#heroList .hero-item[data-id="${champId}"]`);
            if (selectedItem) selectedItem.classList.add('active');
            
            const champ = championData.champions.find(c => c.id === champId);
            if (!champ) return;
            
            currentChampion = champ;
            currentSkin = null;
            currentSound = null;
            
            // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„æ’­æ”¾
            stopAllPlayback();
            
            // æ›´æ–°èƒŒæ™¯
            updateBackground(`champion/${champId}.jpg`);
            
            // æ¸²æŸ“çš®è‚¤åˆ—è¡¨
            renderSkinList(champ);
            
            // æ¸…é™¤è¯­éŸ³åˆ—è¡¨
            document.getElementById('voiceList').innerHTML = '<div class="no-data">è¯·å…ˆé€‰æ‹©çš®è‚¤</div>';
        }
        
        // é€‰æ‹©çš®è‚¤
        function selectSkin(skinId) {
            if (!currentChampion) return;
            
            const skinItems = document.querySelectorAll('#skinList .list-item');
            skinItems.forEach(item => item.classList.remove('active'));
            const selectedItem = document.querySelector(`#skinList .skin-item[data-id="${skinId}"]`);
            if (selectedItem) selectedItem.classList.add('active');
            
            const skin = skinData.skins.find(s => s.id === skinId);
            if (!skin) return;
            
            currentSkin = skin;
            currentSound = null;
            
            // åœæ­¢ä»»ä½•æ­£åœ¨è¿›è¡Œçš„æ’­æ”¾
            stopAllPlayback();
            
            // æ›´æ–°èƒŒæ™¯ï¼ˆä½¿ç”¨çš®è‚¤å›¾ç‰‡ï¼‰
            updateBackground(`skin/${skinId}.jpg`);
            
            // æ¸²æŸ“è¯­éŸ³åˆ—è¡¨
            renderVoiceList(skin);
        }
        
        // æ›´æ–°èƒŒæ™¯
        function updateBackground(imagePath) {
            const bgContainer = document.getElementById('heroBackground');
            bgContainer.style.backgroundImage = `url('${imagePath}')`;
        }
        
        // é€‰æ‹©è¯­éŸ³
        function selectSound(soundId) {
            if (!currentSkin) return;
            
            // åœæ­¢å¾ªç¯æ’­æ”¾
            stopLoopPlay();
            
            const soundItems = document.querySelectorAll('#voiceList .list-item');
            soundItems.forEach(item => item.classList.remove('active'));
            const selectedItem = document.querySelector(`#voiceList .voice-item[data-id="${soundId}"]`);
            if (selectedItem) selectedItem.classList.add('active');
            
            const sound = soundData.sounds.find(s => s.id === soundId);
            if (!sound) return;
            
            currentSound = sound;
            playSound(sound.id);
        }
        
        // æ’­æ”¾è¯­éŸ³
        function playSound(soundId) {
            const player = document.getElementById('audioPlayer');
            player.src = `sound/${soundId}.wav`;
            
            // æ˜¾ç¤ºå­—å¹•
            const sound = soundData.sounds.find(s => s.id === soundId);
            if (sound) {
                const subtitle = document.getElementById('subtitle');
                subtitle.textContent = sound.text;
                subtitle.classList.add('show');
                
                setTimeout(() => {
                    subtitle.classList.remove('show');
                }, 3000);
            }
            
            // å°è¯•æ’­æ”¾è¯­éŸ³
            player.play().catch(error => {
                console.warn('è¯­éŸ³æ’­æ”¾å¤±è´¥:', error);
                // åœ¨æœ¬åœ°å¼€å‘æ—¶ï¼Œæ¨¡æ‹Ÿæ’­æ”¾
                if (error.name === 'NotAllowedError') {
                    console.warn('ç”±äºæƒé™é—®é¢˜æ— æ³•æ’­æ”¾éŸ³é¢‘ï¼Œè½¬ä¸ºåå°æ¨¡æ‹Ÿæ’­æ”¾');
                    
                    // æ¨¡æ‹Ÿ3ç§’çš„æ’­æ”¾æ—¶é—´
                    setTimeout(() => {
                        const event = new Event('ended');
                        player.dispatchEvent(event);
                    }, 3000);
                }
            });
        }
        
        // åˆ‡æ¢é¡ºåºæ’­æ”¾
        function togglePlayAll() {
            if (!currentSkin) return;
            
            const playBtn = document.getElementById('playAllBtn');
            
            if (isPlayingAll) {
                // åœæ­¢æ’­æ”¾
                isPlayingAll = false;
                playBtn.innerHTML = `<span class="icon">â–¶</span> é¡ºåºæ’­æ”¾`;
                
                // æš‚åœå½“å‰è¯­éŸ³
                const player = document.getElementById('audioPlayer');
                player.pause();
            } else {
                // åœæ­¢å¾ªç¯æ’­æ”¾
                stopLoopPlay();
                
                // å¼€å§‹æ’­æ”¾
                isPlayingAll = true;
                playBtn.innerHTML = `<span class="icon">â¸ï¸</span> åœæ­¢æ’­æ”¾`;
                
                // è·å–å½“å‰é€‰ä¸­çš„è¯­éŸ³ç´¢å¼•
                let startIndex = 0;
                if (currentSound) {
                    startIndex = currentSkin.soundIds.indexOf(currentSound.id);
                    if (startIndex === -1) startIndex = 0;
                }
                
                playQueue = currentSkin.soundIds;
                currentPlayingIndex = startIndex;
                playSoundFromQueue();
            }
        }
        
        // åˆ‡æ¢å¾ªç¯æ’­æ”¾
        function toggleLoopPlay() {
            if (!currentSkin) return;
            
            const loopBtn = document.getElementById('loopPlayBtn');
            
            if (isLooping) {
                // åœæ­¢å¾ªç¯
                stopLoopPlay();
            } else {
                // åœæ­¢é¡ºåºæ’­æ”¾
                stopPlayAll();
                
                // å¼€å§‹å¾ªç¯æ’­æ”¾
                isLooping = true;
                loopBtn.innerHTML = `<span class="icon">â¹ï¸</span> åœæ­¢å¾ªç¯`;
                
                // åˆ›å»ºæ’­æ”¾é˜Ÿåˆ—ï¼ˆå½“å‰é¡¹å¼€å§‹ï¼‰
                playQueue = currentSkin.soundIds;
                currentPlayingIndex = currentSound ? 
                    currentSkin.soundIds.indexOf(currentSound.id) : 0;
                if (currentPlayingIndex === -1) currentPlayingIndex = 0;
                
                // ç›´æ¥å¼€å§‹æ’­æ”¾
                playSoundFromQueue();
                
                // è®¾ç½®è‡ªåŠ¨é—´éš”å¾ªç¯
                loopInterval = setInterval(() => {
                    playSoundFromQueue();
                }, 3000); // 3ç§’é—´éš”
            }
        }
        
        // æ’­æ”¾é˜Ÿåˆ—ä¸­çš„è¯­éŸ³
        function playSoundFromQueue() {
            if (currentPlayingIndex >= 0 && currentPlayingIndex < playQueue.length) {
                const soundId = playQueue[currentPlayingIndex];
                selectSound(soundId);
                
                // å¢åŠ ç´¢å¼•ï¼ˆå¾ªç¯æ’­æ”¾æ¨¡å¼åˆ™è®¾ç½®å¾ªç¯ç´¢å¼•ï¼‰
                currentPlayingIndex++;
                if (currentPlayingIndex >= playQueue.length) {
                    currentPlayingIndex = 0;
                }
            }
        }
        
        // åœæ­¢é¡ºåºæ’­æ”¾
        function stopPlayAll() {
            if (isPlayingAll) {
                isPlayingAll = false;
                document.getElementById('playAllBtn').innerHTML = `<span class="icon">â–¶</span> é¡ºåºæ’­æ”¾`;
                const player = document.getElementById('audioPlayer');
                player.pause();
            }
        }
        
        // åœæ­¢å¾ªç¯æ’­æ”¾
        function stopLoopPlay() {
            if (isLooping) {
                isLooping = false;
                document.getElementById('loopPlayBtn').innerHTML = `<span class="icon">ğŸ”</span> å¾ªç¯æ’­æ”¾`;
                clearInterval(loopInterval);
                loopInterval = null;
            }
        }
        
        // åœæ­¢æ‰€æœ‰æ’­æ”¾
        function stopAllPlayback() {
            stopPlayAll();
            stopLoopPlay();
            
            const player = document.getElementById('audioPlayer');
            player.pause();
            player.src = '';
        }
        
        // æ’­æ”¾ä¸‹ä¸€ä¸ª
        function playNextSound() {
            if (isLooping) {
                // å¾ªç¯æ’­æ”¾ç”±å®šæ—¶å™¨æ§åˆ¶ï¼Œä¸éœ€è¦é¢å¤–å¤„ç†
            } else if (isPlayingAll) {
                // é¡ºåºæ’­æ”¾æ¨¡å¼
                currentPlayingIndex++;
                if (currentPlayingIndex >= playQueue.length) {
                    // é¡ºåºæ’­æ”¾ç»“æŸ
                    isPlayingAll = false;
                    document.getElementById('playAllBtn').innerHTML = `<span class="icon">â–¶</span> é¡ºåºæ’­æ”¾`;
                    return;
                }
                playSoundFromQueue();
            }
        }
        
        // åˆ‡æ¢é¢æ¿æ˜¾ç¤º
        function togglePanel(position) {
            const mainContainer = document.querySelector('.main-container');
            
            switch(position) {
                case 'left':
                    mainContainer.classList.toggle('hide-left');
                    document.getElementById('left-fold-btn').textContent = 
                        mainContainer.classList.contains('hide-left') ? 'â–¶' : 'â—€';
                    break;
                case 'right':
                    mainContainer.classList.toggle('hide-right');
                    document.getElementById('right-fold-btn').textContent = 
                        mainContainer.classList.contains('hide-right') ? 'â–¶' : 'â—€';
                    break;
                case 'top':
                    mainContainer.classList.toggle('hide-top');
                    document.getElementById('top-fold-btn').textContent = 
                        mainContainer.classList.contains('hide-top') ? 'â–²' : 'â–¼';
                    break;
            }
        }
    </script>
</body>
</html>
